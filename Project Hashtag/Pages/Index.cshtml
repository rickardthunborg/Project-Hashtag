@page
@model IndexModel
@inject Project_Hashtag.Data.AccessControl accessControl
@{
    ViewData["Title"] = "Home page";
}

 

<ul class="flow">
    <li class="addNewPost">
    <form method="post">
        <div id="newPostTitle">
            <div class="profilePic"></div>
            <input type="text" name="desc" placeholder="What´s happening?">
        </div>
        <p>Choose a tag:</p>
        <select name="tag">
            @foreach (var tag in @Model.Tags)
            {
                <option value="@tag.Id"> @tag.Name</option>
            }
        </select>
        <button type="submit">Post</button>
    </form>
    </li>
    @foreach (var post in Model.Posts)
    {
        var reports = @Model.database.Reports.Where(r => Model.PeopleYouFollow.Select(p => p.UserID).Contains(r.UserID) && r.PostID == post.ID).Count();
        var poster = Model.Users.Single(x => post.UserID == x.ID);
        if (post.UserID == Model.LoggedIn.LoggedInAccountID)
        {
            continue;
        }
        <li>
            @if (reports == 1)
            {
                <span class="reportWarning"> <img src="~/information.png"></img> <p> @reports person you follow have reported this post as untrustworthy.</p></span>
            }
            else if (reports > 0)
            {
                <span class="reportWarning"> <img src="~/information.png"></img> <p> @reports people you follow have reported this post as untrustworthy.</p></span>
            }
            <div class="postProfile">
				<a asp-page="Profile" asp-route-userId="@poster.ID" class="postProfileBox">
                    <div class="profilePic"> </div> 
                    <pre>@poster.Name</pre>
                </a>
                <p>· @post.TimeSincePost()</p>
                <form method="post" asp-page-handler="report" asp-route-id="@post.ID"> <label class="report"> <button type="submit"></button> </label></form>
            </div>
            <p class="postText"> @post.Description</p>
            <ul class="interaction">
                <form method="post" asp-page-handler="like" asp-route-id="@post.ID">
                    <label>
                        <button type="submit"></button>
                        <p>@post.LikeCount</p>
                    </label>
                </form>
                <a>
                    <div class="comments">
                        
                    </div>
                    <p>@Model.Comments.Where(x => x.PostID == post.ID).Count()</p>
                </a>
            </ul>

            @*<p>Comments: </p>
            <ul>
                @foreach (var comment in Model.Comments.Where(x => x.PostID == post.ID).OrderBy(z => z.CreatedDate))
                {
                    var user = Model.Users.Single(x => x.ID == comment.UserID);

                    <li>
                        <p>@comment.Text </p>
                        <a asp-page="Profile" asp-route-userId="@user.ID"><pre>  by: @user.Name</pre></a>
                        @if(comment.UserID == Model.LoggedIn.LoggedInAccountID)
                        {
                        <form method="post" asp-page-handler="deletecomment" asp-route-id="@post.ID"><button type="submit">Delete Comment</button></form>
                        }

                    </li>
                }
            </ul>

            <form method="post" asp-page-handler="comment" asp-route-id="@post.ID">
                <input type="text" name="content"> 
                <button type="submit">Comment</button>
                </form>*@

        </li>
    }
</ul>